{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@3d-dice/dice-box/dist/world.offscreen.js","sources":["file:///home/irakli/Projects/RollKeeper/node_modules/%403d-dice/dice-box/src/components/world.offscreen.js"],"sourcesContent":["import worldWorker from './offscreenCanvas.worker?worker&inline' // using vite.js worker import - this will be compiled away\n\nclass WorldOffScreen {\n\tinitialized = false\n\toffscreenWorkerInit = false\n\tthemeLoadedInit = false\n\tpendingThemePromises = {}\n\t#offscreenCanvas\n\t#OffscreenWorker\n\t// onInitComplete = () => {} // init callback\n\tonRollResult = () => {} // individual die callback\n\tonRollComplete = () => {} // roll group callback\n\n\tconstructor(options){\n\t\tthis.onInitComplete = options.onInitComplete\n\n\t\t// transfer control offscreen\n\t\tthis.#offscreenCanvas = options.canvas.transferControlToOffscreen()\n\n\t\t// initialize 3D World in which BabylonJS runs\n\t\tthis.#OffscreenWorker = new worldWorker()\n\t\t// need to initialize the web worker and get confirmation that initialization is complete before other scripts can run\n\t\t// set a property on the worker to a promise that is resolve when the proper message is returned from the worker\n\t\tthis.#OffscreenWorker.init = new Promise((resolve, reject) => {\n\t\t\tthis.offscreenWorkerInit = resolve\n\t\t})\n\n\t\tthis.initialized = this.#initScene(options)\n\t}\n\n\t// initialize the babylon scene\n\tasync #initScene(config) {\n\t\t// initialize the offscreen worker\n\t\tthis.#OffscreenWorker.postMessage({\n\t\t\taction: \"init\",\n\t\t\tcanvas: this.#offscreenCanvas,\n\t\t\twidth: config.canvas.clientWidth,\n\t\t\theight: config.canvas.clientHeight,\n\t\t\toptions: config.options,\n\t\t}, [this.#offscreenCanvas])\n\n\t\t// handle messages from offscreen BabylonJS World\n\t\tthis.#OffscreenWorker.onmessage = (e) => {\n\t\t\tswitch( e.data.action ) {\n\t\t\t\tcase \"init-complete\":\n\t\t\t\t\tthis.offscreenWorkerInit() //fulfill promise so other things can run\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"connect-complete\":\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"theme-loaded\":\n\t\t\t\t\tif(e.data.id){\n\t\t\t\t\t\tthis.pendingThemePromises[e.data.id](e.data.id)\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roll-result':\n\t\t\t\t\tthis.onRollResult(e.data.die)\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'roll-complete':\n\t\t\t\t\tthis.onRollComplete()\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'die-removed':\n\t\t\t\t\tthis.onDieRemoved(e.data.rollId)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\t// await Promise.all([this.#OffscreenWorker.init])\n\t\tawait this.#OffscreenWorker.init\n\n\t\tthis.onInitComplete(true)\n\n\t\treturn true\n\t}\n\n\tconnect(port){\n\t\t// Setup the connection: Port 1 is for this.#OffscreenWorker\n\t\tthis.#OffscreenWorker.postMessage({\n\t\t\taction : \"connect\",\n\t\t\tport\n\t\t},[ port ])\n\t}\n\n\tupdateConfig(options){\n\t\tthis.#OffscreenWorker.postMessage({action: \"updateConfig\", options});\n\t}\n\n\tresize(options){\n\t\tthis.#OffscreenWorker.postMessage({action: \"resize\", options});\n\t}\n\n\tasync loadTheme(options) {\n\t\t// prevent multiple requests of the same theme\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif(Object.keys(this.pendingThemePromises).includes(options.theme)) {\n\t\t\t\treturn resolve()\n\t\t\t}\n\n\t\t\tthis.pendingThemePromises[options.theme] = resolve\n\t\t\tthis.#OffscreenWorker.postMessage({action: \"loadTheme\", options})\n\t\t}).catch(error => console.error(error))\n\t}\n\n\tclear(){\n\t\tthis.#OffscreenWorker.postMessage({action: \"clearDice\"})\n\t}\n\n\tadd(options){\n\t\tthis.#OffscreenWorker.postMessage({action: \"addDie\", options})\n\t}\n\t\n\taddNonDie(options){\n\t\tthis.#OffscreenWorker.postMessage({action: \"addNonDie\", options})\n\t}\n\n\tremove(options){\n\t\t// remove the die from the render\n\t\tthis.#OffscreenWorker.postMessage({action: \"removeDie\", options})\n\t}\n}\n\nexport default WorldOffScreen"],"names":["WorldOffScreen","options","__privateAdd","_initScene","__publicField","_offscreenCanvas","_OffscreenWorker","__privateSet","worldWorker","__privateGet","resolve","reject","__privateMethod","initScene_fn","port","error","config","e"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,MAAMA,EAAe;IAuEpB,QAAQc,CAAAA,EAAK;QAEZL,EAAA,IAAA,EAAKH,GAAiB,WAAA,CAAY;YACjC,QAAS;YACT,MAAAQ;QACH,GAAI;YAAEA,CAAI;SAAE;IACV;IAED,aAAab,CAAAA,EAAQ;QACpBQ,EAAA,IAAA,EAAKH,GAAiB,WAAA,CAAY;YAAC,QAAQ;YAAgB,SAAAL;QAAO,CAAC;IACnE;IAED,OAAOA,CAAAA,EAAQ;QACdQ,EAAA,IAAA,EAAKH,GAAiB,WAAA,CAAY;YAAC,QAAQ;YAAU,SAAAL;QAAO,CAAC;IAC7D;IAED,MAAM,UAAUA,CAAAA,EAAS;QAExB,OAAO,IAAI,QAAQ,CAACS,GAASC,MAAW;YACvC,IAAG,OAAO,IAAA,CAAK,IAAA,CAAK,oBAAoB,EAAE,QAAA,CAASV,EAAQ,KAAK,GAC/D,OAAOS,EAAS;YAGjB,IAAA,CAAK,oBAAA,CAAqBT,EAAQ,KAAK,CAAA,GAAIS,GAC3CD,EAAA,IAAA,EAAKH,GAAiB,WAAA,CAAY;gBAAC,QAAQ;gBAAa,SAAAL;YAAO,CAAC;QACnE,CAAG,EAAE,KAAA,CAAM,CAAAc,IAAS,QAAQ,KAAA,CAAMA,CAAK,CAAC;IACtC;IAED,QAAO;QACNN,EAAA,IAAA,EAAKH,GAAiB,WAAA,CAAY;YAAC,QAAQ;QAAW,CAAC;IACvD;IAED,IAAIL,CAAAA,EAAQ;QACXQ,EAAA,IAAA,EAAKH,GAAiB,WAAA,CAAY;YAAC,QAAQ;YAAU,SAAAL;QAAO,CAAC;IAC7D;IAED,UAAUA,CAAAA,EAAQ;QACjBQ,EAAA,IAAA,EAAKH,GAAiB,WAAA,CAAY;YAAC,QAAQ;YAAa,SAAAL;QAAO,CAAC;IAChE;IAED,OAAOA,CAAAA,EAAQ;QAEdQ,EAAA,IAAA,EAAKH,GAAiB,WAAA,CAAY;YAAC,QAAQ;YAAa,SAAAL;QAAO,CAAC;IAChE;IAlHmB,sBAAA;IAWpB,YAAYA,CAAAA,CAAQ;QAkBpB,+BAAA;QAAAC,EAAA,IAAA,EAAMC;QA5BNC,EAAA,IAAA,EAAA,eAAc,CAAA;QACdA,EAAA,IAAA,EAAA,uBAAsB,CAAA;QACtBA,EAAA,IAAA,EAAA,mBAAkB,CAAA;QAClBA,EAAA,IAAA,EAAA,wBAAuB,CAAE;QACzBF,EAAA,IAAA,EAAAG,GAAA,KAAA;QACAH,EAAA,IAAA,EAAAI,GAAA,KAAA;QAEA,6CAAA;QAAAF,EAAA,IAAA,EAAA,gBAAe,KAAQ,CAAF;QACrB,0BAAA;QAAAA,EAAA,IAAA,EAAA,kBAAiB,KAAQ,CAAF;QAGtB,IAAA,CAAK,cAAA,GAAiBH,EAAQ,cAAA,EAG9BM,EAAA,IAAA,EAAKF,GAAmBJ,EAAQ,MAAA,CAAO,0BAAA,CAA4B,IAGnEM,EAAA,IAAA,EAAKD,GAAmB,IAAIE,EAAa,IAGzCC,EAAA,IAAA,EAAKH,GAAiB,IAAA,GAAO,IAAI,QAAQ,CAACI,GAASC,MAAW;YAC7D,IAAA,CAAK,mBAAA,GAAsBD;QAC9B,CAAG,GAED,IAAA,CAAK,WAAA,GAAcE,EAAA,IAAA,EAAKT,GAAAU,GAAL,IAAA,CAAA,IAAA,EAAgBZ;IACnC;AAyFF;AA9GCI,IAAA,IAAA,WACAC,IAAA,IAAA,WAuBMH,IAAA,IAAA,WAAAU,IAAU,eAACG,CAAAA,EAAQ;IAExB,OAAAP,EAAA,IAAA,EAAKH,GAAiB,WAAA,CAAY;QACjC,QAAQ;QACR,QAAQG,EAAA,IAAA,EAAKJ;QACb,OAAOW,EAAO,MAAA,CAAO,WAAA;QACrB,QAAQA,EAAO,MAAA,CAAO,YAAA;QACtB,SAASA,EAAO,OAAA;IACnB,GAAK;QAACP,EAAA,IAAA,EAAKJ,EAAgB;KAAC,GAG1BI,EAAA,IAAA,EAAKH,GAAiB,SAAA,GAAY,CAACW,MAAM;QACxC,OAAQA,EAAE,IAAA,CAAK,MAAA,EAAM;YACpB,KAAK;gBACJ,IAAA,CAAK,mBAAA,CAAqB;gBAC1B;YACD,KAAK;gBACJ;YACD,KAAK;gBACDA,EAAE,IAAA,CAAK,EAAA,IACT,IAAA,CAAK,oBAAA,CAAqBA,EAAE,IAAA,CAAK,EAAE,CAAA,CAAEA,EAAE,IAAA,CAAK,EAAE;gBAE/C;YACD,KAAK;gBACJ,IAAA,CAAK,YAAA,CAAaA,EAAE,IAAA,CAAK,GAAG;gBAC5B;YACD,KAAK;gBACJ,IAAA,CAAK,cAAA,CAAgB;gBACrB;YACD,KAAK;gBACJ,IAAA,CAAK,YAAA,CAAaA,EAAE,IAAA,CAAK,MAAM;gBAC/B;QACD;IACD,GAED,MAAMR,EAAA,IAAA,EAAKH,GAAiB,IAAA,EAE5B,IAAA,CAAK,cAAA,CAAe,CAAA,CAAI,GAEjB,CAAA;AACP","debugId":null}}]
}