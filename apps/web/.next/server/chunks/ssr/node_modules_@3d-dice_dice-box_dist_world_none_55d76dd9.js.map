{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@3d-dice/dice-box/dist/world.none.js","sources":["file:///home/irakli/Projects/RollKeeper/node_modules/%403d-dice/dice-box/src/components/world.none.js"],"sourcesContent":["import Dice from './Dice'\nclass WorldNone {\n\tconfig\n\t#canvas\n\tinitialized = false\n\t#dieCache = {}\n\t#count = 0\n\t#sleeperCount = 0\n\t#dieRollTimer = []\n\t#rollCompleteTimer\n\tnoop = () => {}\n\tconstructor(options){\n\t\tthis.onInitComplete = options.onInitComplete || this.noop\n\t\tthis.onThemeLoaded = options.onThemeLoaded || this.noop\n\t\tthis.onRollResult = options.onRollResult || this.noop\n\t\tthis.onRollComplete = options.onRollComplete || this.noop\n\t\tthis.onDieRemoved = options.onDieRemoved || this.noop\n\t\tthis.initialized = this.initScene(options)\n\t}\n\n\tasync initScene(config) {\n\t\t// set the config from World\n\t\tthis.config = config.options\n\n\t\t// init complete - let the world know\n\t\tthis.onInitComplete()\n\t}\n\n\tresize(){\n\t\t\n\t}\n\n\tloadTheme(){\n\t\treturn Promise.resolve()\n\t}\n\n\tupdateConfig(options){\n\t\tObject.assign(this.config, options)\n\t}\n\n\taddNonDie(die){\n\t\tconsole.log('die', die)\n\t\tclearTimeout(this.#rollCompleteTimer)\n\t\tconst {id, value, ...rest} = die\n\t\tconst newDie = {\n\t\t\tid,\n\t\t\tvalue,\n\t\t\tconfig: rest\n\t\t}\n\t\tthis.#dieCache[id] = newDie\n\t\t\n\t\tthis.#dieRollTimer.push(setTimeout(() => {\n\t\t\tthis.handleAsleep(newDie)\n\t\t}, this.#count++ * this.config.delay))\n\n\t\t// since we don't have a render loop, we'll set an internal timer\n\t\tthis.#rollCompleteTimer = setTimeout(() => {\n\t\t\tthis.onRollComplete()\n\t\t}, 500)\n\t}\n\n\tadd(die){\n\t\tconsole.log(\"add die\")\n\t\tthis.addNonDie(die)\n\t}\n\n\tremove(data){\n\t\tconsole.log(\"remove die\")\n\t\t// TODO: test this with exploding dice\n\t\tconst dieData = this.#dieCache[data.id]\n\t\t\n\t\t// check if this is d100 and remove associated d10 first\n\t\tif(dieData.hasOwnProperty('d10Instance')){\n\t\t\t// delete entry\n\t\t\tdelete this.#dieCache[dieData.d10Instance.id]\n\t\t\t// decrement count\n\t\t\tthis.#sleeperCount--\n\t\t}\n\n\t\t// delete entry\n\t\tdelete this.#dieCache[data.id]\n\t\t// decrement count\n\t\tthis.#sleeperCount--\n\n\t\tthis.onDieRemoved(data.rollId)\n\t}\n\n\tclear(){\n\t\tif(!Object.keys(this.#dieCache).length && !this.#sleeperCount) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.#dieRollTimer.forEach(timer=>clearTimeout(timer))\n\n\t\t// remove all dice\n\t\tObject.values(this.#dieCache).forEach(die => {\n\t\t\tif(die.mesh)\n\t\t\t\tdie.mesh.dispose()\n\t\t})\n\t\t\n\t\t// reset storage\n\t\tthis.#dieCache = {}\n\t\tthis.#count = 0\n\t\tthis.#sleeperCount = 0\n\t}\n\n\t// handle the position updates from the physics worker. It's a simple flat array of numbers for quick and easy transfer\n\tasync handleAsleep(die){\n\t\t// mark this die as asleep\n\t\tdie.asleep = true\n\t\n\t\t// get the roll result for this die\n\t\tawait Dice.getRollResult(die)\n\t\n\t\tif(die.d10Instance || die.dieParent) {\n\t\t\t// if one of the pair is asleep and the other isn't then it falls through without getting the roll result\n\t\t\t// otherwise both dice in the d100 are asleep and ready to calc their roll result\n\t\t\tif(die?.d10Instance?.asleep || die?.dieParent?.asleep) {\n\t\t\t\tconst d100 = die.config.sides === 100 ? die : die.dieParent\n\t\t\t\tconst d10 = die.config.sides === 10 ? die : die.d10Instance\n\t\t\t\tif (d10.value === 0 && d100.value === 0) {\n\t\t\t\t\td100.value = 100; // 00 + 0 is 100 on a d100\n\t\t\t\t} else {\n\t\t\t\t\td100.value = d100.value + d10.value\n\t\t\t\t}\n\t\n\t\t\t\tthis.onRollResult({\n\t\t\t\t\trollId: d100.config.rollId,\n\t\t\t\t\tvalue : d100.value\n\t\t\t\t})\n\t\t\t}\n\t\t} else {\n\t\t\t// turn 0's on a d10 into a 10\n\t\t\tif(die.config.sides === 10 && die.value === 0) {\n\t\t\t\tdie.value = 10\n\t\t\t}\n\t\t\tthis.onRollResult({\n\t\t\t\trollId: die.config.rollId,\n\t\t\t\tvalue: die.value\n\t\t\t})\n\t\t}\n\t\t// add to the sleeper count\n\t\tthis.#sleeperCount++\n\t}\n}\n\nexport default WorldNone"],"names":["WorldNone","options","__publicField","__privateAdd","_canvas","_dieCache","_count","_sleeperCount","_dieRollTimer","_rollCompleteTimer","config","die","__privateGet","id","value","rest","newDie","__privateWrapper","__privateSet","data","dieData","timer","Dice","_a","_b","d100","d10"],"mappings":"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","debugId":null}}]
}